-- Assignment 8
-- Chuyi Guo

-- Part 5

-- Table ZIP
CREATE TABLE A8_ZIP (
  Zip varchar2(5),
  City varchar2(100),
  State varchar2(2)
); 

ALTER TABLE A8_ZIP ADD CONSTRAINT A8_ZIP_PK PRIMARY KEY (Zip);
ALTER TABLE A8_ZIP ADD CONSTRAINT A8_ZIP_CK1 CHECK (REGEXP_LIKE(Zip,'^[0-9]{5}$'));
ALTER TABLE A8_ZIP ADD CONSTRAINT A8_ZIP_CK2 Check (State IN ('AL','AK','AZ','AR','CA','CO','CT','DE','FL','GA','HI','ID','IL','IN','IA','KS','KY','LA','ME','MD','MA','MI','MN','MS','MO','MT'
,'NE','NV','NH','NJ','NM','NY','NC','ND','OH','OK','OR','PA','RI','SC','SD','TN','TX','UT','VT','VA','WA','WV','WI','WY','DC'));

INSERT INTO A8_ZIP
VALUES ('61820', 'Champaign', 'IL');
INSERT INTO A8_ZIP
VALUES ('61801', 'Urbana', 'IL');
INSERT INTO A8_ZIP
VALUES ('61874', 'Savoy', 'IL');
INSERT INTO A8_ZIP
VALUES ('60608', 'Chicago', 'IL');

-- Table EMPLOYEE
CREATE TABLE A8_EMPLOYEE (
  EmployeeID number NOT NULL,
  FirstNM varchar2(100) NOT NULL,
  LastNM varchar2(100) NOT NULL,
  Street varchar2(100),
  Zip varchar2(5),
  Sex varchar2(1),
  BirthDT date,
  Phone varchar2(10),
  Email varchar2(100),
  HighestDegree varchar2(100)
); 

ALTER TABLE A8_EMPLOYEE ADD CONSTRAINT A8_EMPLOYEE_PK PRIMARY KEY (EmployeeID);
ALTER TABLE A8_EMPLOYEE ADD CONSTRAINT A8_EMPLOYEE_FK FOREIGN KEY (Zip) REFERENCES A8_ZIP(Zip);
ALTER TABLE A8_EMPLOYEE ADD CONSTRAINT A8_EMPLOYEE_CK1 CHECK (REGEXP_LIKE(Phone, '^[[:digit:]]{10}$'));
ALTER TABLE A8_EMPLOYEE ADD CONSTRAINT A8_EMPLOYEE_CK2 CHECK (HighestDegree IN ('High-school','Undergraduate','Master','PHD','Post-doctor'));
ALTER TABLE A8_EMPLOYEE ADD CONSTRAINT A8_EMPLOYEE_CK3 CHECK (REGEXP_LIKE(Zip,'^[0-9]{5}$'));
ALTER TABLE A8_EMPLOYEE ADD CONSTRAINT A8_EMPLOYEE_CK4 CHECK (Sex IN ('F','M'));

INSERT INTO A8_EMPLOYEE
VALUES (1, 'Daenerys', 'Targaryen','1010 1st.','61820','F',TO_DATE('1/1/1975','mm/dd/yyyy'),'2172170000','Daenerys@fund.com','Post-doctor');
INSERT INTO A8_EMPLOYEE
VALUES (2, 'Theon', 'Greyjoy','1011 1st.','61820','M',TO_DATE('1/1/1980','mm/dd/yyyy'),'2172170001','Theon@fund.com','PHD');
INSERT INTO A8_EMPLOYEE
VALUES (3, 'Tyrion', 'Lannister','1 1st.','61801','F',TO_DATE('1/1/1981','mm/dd/yyyy'),'2172170002','Tyrion@fund.com','Master');
INSERT INTO A8_EMPLOYEE
VALUES (4, 'Catelyn', 'Stark','2 1st.','61874','F',TO_DATE('1/1/1990','mm/dd/yyyy'),'2172170003','Catelyn@fund.com','Undergraduate');
INSERT INTO A8_EMPLOYEE
VALUES (5, 'Joffrey','Baratheon','3 1st.','60608','M',TO_DATE('5/5/1985','mm/dd/yyyy'),'2172170004','Joffrey@fund.com','Master');
INSERT INTO A8_EMPLOYEE
VALUES (6, 'Davos','Seaworth','4 1st.','60608','M',TO_DATE('10/1/1981','mm/dd/yyyy'),'2172170005','Davos@fund.com','Master');
INSERT INTO A8_EMPLOYEE
VALUES (7, 'Khal','Drogo','5 1st.','61820','M',TO_DATE('10/1/1988','mm/dd/yyyy'),'2172170006','Khal@fund.com','Undergraduate');

-- Table CERTIFICATES
CREATE TABLE A8_CERTIFICATES (
  EmployeeID number NOT NULL,
  Certificates varchar2(100)
); 

ALTER TABLE A8_CERTIFICATES ADD CONSTRAINT A8_CERTIFICATES_PK PRIMARY KEY (EmployeeID,Certificates);
ALTER TABLE A8_CERTIFICATES ADD CONSTRAINT A8_CERTIFICATES_FK FOREIGN KEY (EmployeeID) REFERENCES A8_EMPLOYEE(EmployeeID);

INSERT INTO A8_CERTIFICATES
VALUES (1, 'CFA');
INSERT INTO A8_CERTIFICATES
VALUES (1, 'CPA');
INSERT INTO A8_CERTIFICATES
VALUES (1, 'FRM');
INSERT INTO A8_CERTIFICATES
VALUES (2, 'CFA');
INSERT INTO A8_CERTIFICATES
VALUES (2, 'FRM');
INSERT INTO A8_CERTIFICATES
VALUES (6, 'FRM');
INSERT INTO A8_CERTIFICATES
VALUES (3, 'CFA');

-- Table MANAGER
CREATE TABLE A8_MANAGER (
  ManagerID number NOT NULL,
  ExperienceInfo varchar2(500)
); 

ALTER TABLE A8_MANAGER ADD CONSTRAINT A8_MANAGER PRIMARY KEY (ManagerID);
ALTER TABLE A8_MANAGER ADD CONSTRAINT A8_MANAGER_FK FOREIGN KEY (ManagerID) REFERENCES A8_EMPLOYEE(EmployeeID);

INSERT INTO A8_MANAGER
VALUES (1, 'She has 18 years of investment experience, mainly focusing on stock investment');
INSERT INTO A8_MANAGER
VALUES (2, 'He has 10 years of investment experience, mainly focusing on bond investment');
INSERT INTO A8_MANAGER
VALUES (3, 'He used to be a Internet Industy expert and joined the company 5 years ago. He has very successful investment experience for technology stocks');

-- Table TRADER 
CREATE TABLE A8_TRADER  (
  TraderID number NOT NULL
); 

ALTER TABLE A8_TRADER ADD CONSTRAINT A8_TRADER_PK PRIMARY KEY (TraderID);
ALTER TABLE A8_TRADER ADD CONSTRAINT A8_TRADER_FK FOREIGN KEY (TraderID) REFERENCES A8_EMPLOYEE(EmployeeID);

INSERT INTO A8_TRADER
VALUES (4);
INSERT INTO A8_TRADER
VALUES (5);

-- Table ANALYST  
CREATE TABLE A8_ANALYST  (
  AnalystID number NOT NULL
); 

ALTER TABLE A8_ANALYST ADD CONSTRAINT A8_ANALYST_PK PRIMARY KEY (AnalystID);
ALTER TABLE A8_ANALYST ADD CONSTRAINT A8_ANALYST_FK FOREIGN KEY (AnalystID) REFERENCES A8_EMPLOYEE(EmployeeID);

INSERT INTO A8_ANALYST 
VALUES (6);
INSERT INTO A8_ANALYST 
VALUES (7);


-- Table INVESTOR  
CREATE TABLE A8_INVESTOR  (
  InvestorID number NOT NULL,
  FirstNM varchar2(100) NOT NULL,
  LastNM varchar2(100) NOT NULL,
  AccountNo varchar2(20) NOT NULL,
  RoutineNo varchar2(20) NOT NULL,
  Street varchar2(100),
  Zip varchar2(5),
  Phone varchar2(10),
  Email varchar2(100)
); 

ALTER TABLE A8_INVESTOR ADD CONSTRAINT A8_INVESTOR_PK PRIMARY KEY (InvestorID);
ALTER TABLE A8_INVESTOR ADD CONSTRAINT A8_INVESTOR_FK FOREIGN KEY (Zip) REFERENCES A8_ZIP(Zip);
ALTER TABLE A8_INVESTOR ADD CONSTRAINT A8_INVESTOR_CK CHECK (REGEXP_LIKE(Phone, '^[[:digit:]]{10}$'));

INSERT INTO A8_INVESTOR 
VALUES (1,'Jorah','Mormont', '1234567890','123456789','107 E Healy','61820','2171230001','Jorah@gamil.com');
INSERT INTO A8_INVESTOR 
VALUES (2,'Ramsay','Bolton', '1234567891','123456789','110 E Healy','61820','2171230002','Ramsay@gamil.com');
INSERT INTO A8_INVESTOR 
VALUES (3,'Stannis','Baratheon', '1234567892','123456789','117 St.','61874','2171230003','Stannis@gamil.com');
INSERT INTO A8_INVESTOR 
VALUES (4,'Yara', 'Greyjoy', '1234567198','987654321','1170 Main St.','61801','2171230004','Yara@gamil.com');
INSERT INTO A8_INVESTOR 
VALUES (5,'Jon','Snow', '987654321','234567891','1 first St.','60608','2171230005','Jon@gamil.com');
INSERT INTO A8_INVESTOR 
VALUES (6,'Bran','Stark','1234567891','345678912','2 first St.','60608','2171230006','Bran@gamil.com');
INSERT INTO A8_INVESTOR 
VALUES (7,'Eddard','Stark', '1234567891','454545678','3 first St.','60608','2171230007','Eddard@gamil.com');


-- Table FUND  
CREATE TABLE A8_FUND  (
  FundID number NOT NULL,
  FundNM varchar2(100) NOT NULL,
  RiskLevel varchar2(1),
  Description varchar2(500)
); 

ALTER TABLE A8_FUND ADD CONSTRAINT A8_FUND_PK PRIMARY KEY (FundID);
ALTER TABLE A8_FUND ADD CONSTRAINT A8_FUND_CK CHECK (RiskLevel IN ('1','2','3','4','5'));

INSERT INTO A8_FUND 
VALUES (1,'Nasdaq fund','5','Only invest Nasdaq stock');
INSERT INTO A8_FUND 
VALUES (2,'Technology fund','5','Only invest technology stocks');
INSERT INTO A8_FUND 
VALUES (3,'Hybrid fund 1','3','invest both NYSE stock and long-term bond');
INSERT INTO A8_FUND 
VALUES (4,'New York short-term bond','1','Only invest short-term bond, high liquidity, tax-exempt');

-- Table MANAGE
 CREATE TABLE A8_MANAGE (
  ManagerID number NOT NULL,
  FundID number NOT NULL
); 

ALTER TABLE A8_MANAGE ADD CONSTRAINT A8_MANAGE_PK PRIMARY KEY (ManagerID,FundID);
ALTER TABLE A8_MANAGE ADD CONSTRAINT A8_MANAGE_FK1 FOREIGN KEY (FundID) REFERENCES A8_FUND(FundID);
ALTER TABLE A8_MANAGE ADD CONSTRAINT A8_MANAGE_FK2 FOREIGN KEY (ManagerID) REFERENCES A8_MANAGER(ManagerID);

INSERT INTO A8_MANAGE
VALUES (1,1);
INSERT INTO A8_MANAGE
VALUES (1,3);
INSERT INTO A8_MANAGE
VALUES (2,3);
INSERT INTO A8_MANAGE
VALUES (2,4);
INSERT INTO A8_MANAGE
VALUES (3,2);

-- Table INVEST
 CREATE TABLE A8_INVEST (
  InvestorID number NOT NULL,
  FundID number NOT NULL,
  InvestDT date NOT NULL,
  Amount number NOT NULL
); 

ALTER TABLE A8_INVEST ADD CONSTRAINT A8_INVEST_PK PRIMARY KEY (InvestorID,FundID,InvestDT);
ALTER TABLE A8_INVEST ADD CONSTRAINT A8_INVEST_FK1 FOREIGN KEY (InvestorID) REFERENCES A8_INVESTOR(InvestorID);
ALTER TABLE A8_INVEST ADD CONSTRAINT A8_INVEST_FK2 FOREIGN KEY (FundID) REFERENCES A8_FUND(FundID);
ALTER TABLE A8_INVEST ADD CONSTRAINT A8_INVEST_CK CHECK (Amount>0);

INSERT INTO A8_INVEST
VALUES(1,1,TO_DATE('11/1/2018','mm/dd/yyyy'),5000);
INSERT INTO A8_INVEST
VALUES(1,2,TO_DATE('11/1/2018','mm/dd/yyyy'),5000);
INSERT INTO A8_INVEST
VALUES(2,1,TO_DATE('11/2/2018','mm/dd/yyyy'),1000);
INSERT INTO A8_INVEST
VALUES(3,1,TO_DATE('11/3/2018','mm/dd/yyyy'),10000);
INSERT INTO A8_INVEST
VALUES(3,2,TO_DATE('11/3/2018','mm/dd/yyyy'),5000);
INSERT INTO A8_INVEST
VALUES(3,3,TO_DATE('11/3/2018','mm/dd/yyyy'),5000);
INSERT INTO A8_INVEST
VALUES(4,2,TO_DATE('11/10/2018','mm/dd/yyyy'),5000);
INSERT INTO A8_INVEST
VALUES(4,3,TO_DATE('11/10/2018','mm/dd/yyyy'),1000);
INSERT INTO A8_INVEST
VALUES(5,3,TO_DATE('11/10/2018','mm/dd/yyyy'),2500);
INSERT INTO A8_INVEST
VALUES(6,4,TO_DATE('11/15/2018','mm/dd/yyyy'),1000);
INSERT INTO A8_INVEST
VALUES(7,4,TO_DATE('11/25/2018','mm/dd/yyyy'),500);

-- Table StockNM
CREATE TABLE A8_STOCKNM  (
  StockNM varchar2(100) NOT NULL,
  CompanyNM varchar2(100),
  StockExchange varchar2(100)
); 

ALTER TABLE A8_STOCKNM ADD CONSTRAINT A8_STOCKNM_PK PRIMARY KEY (StockNM);

INSERT INTO A8_STOCKNM 
VALUES ('TSLA','Tesla Inc','NASDAQ');
INSERT INTO A8_STOCKNM 
VALUES ('AMZN','Amazon.com, Inc','NASDAQ');
INSERT INTO A8_STOCKNM 
VALUES ('INTC','Intel Corp','NASDAQ');
INSERT INTO A8_STOCKNM 
VALUES ('GOOG','Alphabet, Inc','NASDAQ');
INSERT INTO A8_STOCKNM 
VALUES ('AAPL','Apple, Inc','NASDAQ');
INSERT INTO A8_STOCKNM 
VALUES ('WMT','Walmart, Inc','NYSE');
INSERT INTO A8_STOCKNM 
VALUES ('BAC','Bank of America Corp','NYSE');

-- Table STOCK  
CREATE TABLE A8_STOCK  (
  StockID number NOT NULL,
  StockNM varchar2(100) NOT NULL,
  Quantity number NOT NULL
); 

ALTER TABLE A8_STOCK ADD CONSTRAINT A8_STOCK_PK PRIMARY KEY (StockID);
ALTER TABLE A8_STOCK ADD CONSTRAINT A8_STOCK_FK FOREIGN KEY (StockNM) REFERENCES A8_STOCKNM(StockNM);
ALTER TABLE A8_STOCK ADD CONSTRAINT A8_STOCK_CK CHECK (Quantity>=0);

INSERT INTO A8_STOCK 
VALUES (1,'TSLA','5000');
INSERT INTO A8_STOCK 
VALUES (2,'AMZN','15000');
INSERT INTO A8_STOCK 
VALUES (3,'INTC','30000');
INSERT INTO A8_STOCK 
VALUES (4,'GOOG','20000');
INSERT INTO A8_STOCK 
VALUES (5,'AAPL','20000');
INSERT INTO A8_STOCK 
VALUES (6,'WMT','5000');
INSERT INTO A8_STOCK 
VALUES (7,'BAC','5000');

-- Table CONTAINS
 CREATE TABLE A8_CONTAINS (
  FundID number NOT NULL,
  StockID number NOT NULL
); 

ALTER TABLE A8_CONTAINS ADD CONSTRAINT A8_CONTAINS_PK PRIMARY KEY (FundID,StockID);
ALTER TABLE A8_CONTAINS ADD CONSTRAINT A8_CONTAINS_FK1 FOREIGN KEY (FundID) REFERENCES A8_FUND(FundID);
ALTER TABLE A8_CONTAINS ADD CONSTRAINT A8_CONTAINS_FK2 FOREIGN KEY (StockID) REFERENCES A8_STOCK(StockID);

INSERT INTO A8_CONTAINS 
VALUES (1,1);
INSERT INTO A8_CONTAINS 
VALUES (1,2);
INSERT INTO A8_CONTAINS 
VALUES (1,3);
INSERT INTO A8_CONTAINS 
VALUES (2,3);
INSERT INTO A8_CONTAINS 
VALUES (2,4);
INSERT INTO A8_CONTAINS 
VALUES (2,5);
INSERT INTO A8_CONTAINS 
VALUES (4,6);
INSERT INTO A8_CONTAINS 
VALUES (4,7);

-- Table TRANSACTION
CREATE TABLE A8_TRANSACTION (
  TransactionID number NOT NULL,
  Buy_Sell varchar2(5) NOT NULL,
  Quantity number NOT NULL,
  ManagerID number NOT NULL,
  TraderID number NOT NULL,
  StockID number NOT NULL,
  TransactionDate date NOT NULL,
  TransactionTime varchar2(100) NOT NULL
); 

ALTER TABLE A8_TRANSACTION ADD CONSTRAINT A8_TRANSACTION_PK PRIMARY KEY (TransactionID);
ALTER TABLE A8_TRANSACTION ADD CONSTRAINT A8_TRANSACTION_FK1 FOREIGN KEY (ManagerID) REFERENCES A8_MANAGER(ManagerID);
ALTER TABLE A8_TRANSACTION ADD CONSTRAINT A8_TRANSACTION_FK2 FOREIGN KEY (TraderID) REFERENCES A8_TRADER(TraderID);
ALTER TABLE A8_TRANSACTION ADD CONSTRAINT A8_TRANSACTION_FK3 FOREIGN KEY (StockID) REFERENCES A8_STOCK(StockID);
ALTER TABLE A8_TRANSACTION ADD CONSTRAINT A8_TRANSACTION_CK1 CHECK (Buy_Sell IN ('BUY','SELL'));
ALTER TABLE A8_TRANSACTION ADD CONSTRAINT A8_TRANSACTION_CK2 CHECK (Quantity>0);

INSERT INTO A8_TRANSACTION
VALUES (1,'BUY',1000,1,4,1,TO_DATE('11/1/2018','mm/dd/yyyy'),'10:01:00');
INSERT INTO A8_TRANSACTION
VALUES (2,'BUY',1000,1,4,1,TO_DATE('11/2/2018','mm/dd/yyyy'),'14:30:00');
INSERT INTO A8_TRANSACTION
VALUES (3,'SELL',2000,1,4,1,TO_DATE('11/5/2018','mm/dd/yyyy'),'11:05:00');
INSERT INTO A8_TRANSACTION
VALUES (4,'SELL',1000,1,5,1,TO_DATE('11/6/2018','mm/dd/yyyy'),'10:05:00');
INSERT INTO A8_TRANSACTION
VALUES (5,'SELL',1500,1,5,1,TO_DATE('11/16/2018','mm/dd/yyyy'),'11:05:00');
INSERT INTO A8_TRANSACTION
VALUES (6,'SELL',1000,2,4,4,TO_DATE('11/15/2018','mm/dd/yyyy'),'11:15:00');
INSERT INTO A8_TRANSACTION
VALUES (7,'SELL',500,1,4,6,TO_DATE('11/20/2018','mm/dd/yyyy'),'13:15:00');
INSERT INTO A8_TRANSACTION
VALUES (8,'BUY',1000,1,5,6,TO_DATE('11/30/2018','mm/dd/yyyy'),'09:55:00');

-- Table REPORT
CREATE TABLE A8_REPORT (
  ReportID number NOT NULL,
  ReportTitle varchar2(100) NOT NULL,
  StockNM  varchar2(20) NOT NULL,
  InvestAdvice varchar2(20) NOT NULL,
  ReportDT date NOT NULL,
  Summary varchar2(100),
  StockID number 
); 

ALTER TABLE A8_REPORT ADD CONSTRAINT A8_REPORT_PK PRIMARY KEY (ReportID);
ALTER TABLE A8_REPORT ADD CONSTRAINT A8_REPORT_FK FOREIGN KEY (StockID) REFERENCES A8_STOCK(StockID);
ALTER TABLE A8_REPORT ADD CONSTRAINT A8_REPORT_CK CHECK (InvestAdvice IN ('BUY','SELL','HOLD'));

INSERT INTO A8_REPORT
VALUES (1,'TSLA 3rd financial statement analysis','TSLA','BUY',TO_DATE('11/20/2018','mm/dd/yyyy'),'much better than expected',1);
INSERT INTO A8_REPORT
VALUES (2,'AMZN 3rd financial statement analysis','AMZN','BUY',TO_DATE('11/20/2018','mm/dd/yyyy'),'better than expected',2);
INSERT INTO A8_REPORT
VALUES (3,'INTC 3rd financial statement analysis','INTC','BUY',TO_DATE('11/20/2018','mm/dd/yyyy'),'better than expected',3);
INSERT INTO A8_REPORT
VALUES (4,'GOOG 3rd financial statement analysis','GOOG','BUY',TO_DATE('11/20/2018','mm/dd/yyyy'),'better than expected',4);
INSERT INTO A8_REPORT
VALUES (5,'AAPL 3rd financial statement analysis','AAPL','BUY',TO_DATE('11/20/2018','mm/dd/yyyy'),'better than expected',5);
INSERT INTO A8_REPORT
VALUES (6,'WMT 3rd financial statement analysis','WMT','BUY',TO_DATE('11/20/2018','mm/dd/yyyy'),'leading position in industry',6);
INSERT INTO A8_REPORT
VALUES (7,'BAC 3rd financial statement analysis','BAC','BUY',TO_DATE('11/20/2018','mm/dd/yyyy'),'better than expected',7);
INSERT INTO A8_REPORT
VALUES (8,'TSLA having bad news','TSLA','SELL',TO_DATE('11/20/2018','mm/dd/yyyy'),'unexpected bad news',1);
INSERT INTO A8_REPORT
VALUES (9,'GOOG develops new busniess','GOOG','HOLD',TO_DATE('11/20/2018','mm/dd/yyyy'),'within expectation',4);
INSERT INTO A8_REPORT
VALUES (10,'YELP develops new busniess','YELP','BUY',TO_DATE('11/20/2018','mm/dd/yyyy'),'unexpected good news',null);
INSERT INTO A8_REPORT
VALUES (11,'JPM 3rd financial statement analysis','JPM','BUY',TO_DATE('11/20/2018','mm/dd/yyyy'),'stable profit',null);

-- Table WRITE
 CREATE TABLE A8_WRITE (
  AnalystID number NOT NULL,
  ReportID number NOT NULL
); 

ALTER TABLE A8_WRITE ADD CONSTRAINT A8_WRITE PRIMARY KEY (AnalystID,ReportID);
ALTER TABLE A8_WRITE ADD CONSTRAINT A8_WRITE_FK1 FOREIGN KEY (AnalystID) REFERENCES A8_ANALYST(AnalystID);
ALTER TABLE A8_WRITE ADD CONSTRAINT A8_WRITE_FK2 FOREIGN KEY (ReportID) REFERENCES A8_REPORT(ReportID);

INSERT INTO A8_WRITE
VALUES (6,1);
INSERT INTO A8_WRITE
VALUES (6,2);
INSERT INTO A8_WRITE
VALUES (6,3);
INSERT INTO A8_WRITE
VALUES (6,4);
INSERT INTO A8_WRITE
VALUES (6,5);
INSERT INTO A8_WRITE
VALUES (7,6);
INSERT INTO A8_WRITE
VALUES (7,7);
INSERT INTO A8_WRITE
VALUES (7,8);
INSERT INTO A8_WRITE
VALUES (7,9);
INSERT INTO A8_WRITE
VALUES (6,10);
INSERT INTO A8_WRITE
VALUES (7,10);
INSERT INTO A8_WRITE
VALUES (6,11);

-- Table EVENT
 CREATE TABLE A8_EVENT (
  EventID number NOT NULL,
  Topic varchar2(100) NOT NULL ,
  EventDT date NOT NULL，
  StartTime varchar2(20) NOT NULL,
  Street varchar2(100),
  Zip varchar2(5)
); 

ALTER TABLE A8_EVENT ADD CONSTRAINT A8_EVENT_PK PRIMARY KEY (EventID);
ALTER TABLE A8_EVENT ADD CONSTRAINT A8_EVENT_FK FOREIGN KEY (Zip) REFERENCES A8_ZIP(Zip);
ALTER TABLE A8_EVENT ADD CONSTRAINT A8_EVENT_CK CHECK (REGEXP_LIKE(Zip,'^[0-9]{5}$'));

INSERT INTO A8_EVENT
VALUES (1,'Weekly News Analysis',TO_DATE('11/2/2018','mm/dd/yyyy'),'19:00:00','101 First.','61820');
INSERT INTO A8_EVENT
VALUES (2,'Weekly News Analysis',TO_DATE('11/9/2018','mm/dd/yyyy'),'19:00:00','101 First.','61820');
INSERT INTO A8_EVENT
VALUES (3,'Weekly News Analysis',TO_DATE('11/16/2018','mm/dd/yyyy'),'19:00:00','101 First.','61820');
INSERT INTO A8_EVENT
VALUES (4,'Weekly News Analysis',TO_DATE('11/23/2018','mm/dd/yyyy'),'19:00:00','101 First.','61820');
INSERT INTO A8_EVENT
VALUES (5,'View after Fed increased Fed rate',TO_DATE('11/30/2018','mm/dd/yyyy'),'19:00:00','101 First.','61820');

-- Table PARTICIPATE
 CREATE TABLE A8_PARTICIPATE (
  EventID number NOT NULL,
  InvestorID number NOT NULL
); 

ALTER TABLE A8_PARTICIPATE ADD CONSTRAINT A8_PARTICIPATE_PK PRIMARY KEY (EventID,InvestorID);
ALTER TABLE A8_PARTICIPATE ADD CONSTRAINT A8_PARTICIPATE_FK1 FOREIGN KEY (EventID) REFERENCES A8_EVENT(EventID);
ALTER TABLE A8_PARTICIPATE ADD CONSTRAINT A8_PARTICIPATE_FK2 FOREIGN KEY (InvestorID) REFERENCES A8_INVESTOR(InvestorID);

INSERT INTO A8_PARTICIPATE
VALUES (1,1);
INSERT INTO A8_PARTICIPATE
VALUES (1,2);
INSERT INTO A8_PARTICIPATE
VALUES (1,3);
INSERT INTO A8_PARTICIPATE
VALUES (2,1);
INSERT INTO A8_PARTICIPATE
VALUES (2,3);
INSERT INTO A8_PARTICIPATE
VALUES (3,1);
INSERT INTO A8_PARTICIPATE
VALUES (4,4);
INSERT INTO A8_PARTICIPATE
VALUES (4,1);
INSERT INTO A8_PARTICIPATE
VALUES (5,1);
INSERT INTO A8_PARTICIPATE
VALUES (5,2);
INSERT INTO A8_PARTICIPATE
VALUES (5,3);
INSERT INTO A8_PARTICIPATE
VALUES (5,4);
INSERT INTO A8_PARTICIPATE
VALUES (5,5);

-- Table PRESENT
 CREATE TABLE A8_PRESENT (
  EventID number NOT NULL,
  EmployeeID number NOT NULL
); 

ALTER TABLE A8_PRESENT ADD CONSTRAINT A8_PRESENT_PK PRIMARY KEY (EventID,EmployeeID);
ALTER TABLE A8_PRESENT ADD CONSTRAINT A8_PRESENT_FK1 FOREIGN KEY (EventID) REFERENCES A8_EVENT(EventID);
ALTER TABLE A8_PRESENT ADD CONSTRAINT A8_PRESENT_FK2 FOREIGN KEY (EmployeeID) REFERENCES A8_EMPLOYEE(EmployeeID);

INSERT INTO A8_PRESENT
VALUES (1,1);
INSERT INTO A8_PRESENT
VALUES (1,2);
INSERT INTO A8_PRESENT
VALUES (2,3);
INSERT INTO A8_PRESENT
VALUES (3,6);
INSERT INTO A8_PRESENT
VALUES (4,1);
INSERT INTO A8_PRESENT
VALUES (5,1);
INSERT INTO A8_PRESENT
VALUES (5,2);
INSERT INTO A8_PRESENT
VALUES (5,3);

-- Part 6

-- Question 1
-- Manager Daenerys Targaryen
SELECT temp3.FirstNM, temp3.LastNM, temp3.Street, A8_ZIP.City, A8_ZIP.State, temp3.Zip, temp3.FundNM
FROM A8_ZIP
JOIN
(SELECT *
FROM A8_INVESTOR
JOIN
(SELECT DISTINCT InvestorID, temp.FundNM
FROM A8_INVEST
JOIN 
(SELECT A8_Fund.FundID, A8_Fund.FundNM
FROM A8_MANAGE 
JOIN A8_Fund ON A8_MANAGE.FundID=A8_Fund.FUNDID
WHERE ManagerID IN (SELECT EmployeeID
                    FROM A8_EMPLOYEE 
                    WHERE FirstNM='Daenerys' AND LastNM='Targaryen')) temp
ON A8_INVEST.FundID=temp.FundID) temp2
ON A8_INVESTOR.InvestorID=temp2.InvestorID) temp3
ON A8_ZIP.Zip=temp3.Zip
ORDER BY FUNDNM;

-- Question 2
-- Investor Jorah Mormont
SELECT b.FundNM, A8_STOCK.StockNM
FROM A8_STOCK JOIN 
(SELECT *
FROM A8_CONTAINS JOIN
(SELECT FUNDID, FundNM
FROM A8_FUND
WHERE FUNDID IN (SELECT FUNDID
                 FROM A8_INVEST
                 WHERE InvestorID IN (SELECT InvestorID
                                      FROM A8_INVESTOR
                                      WHERE FirstNM='Jorah' AND LastNM='Mormont')))a
ON A8_CONTAINS.FUNDID=a.FUNDID) b
ON A8_STOCK.StockID=b.StockID
ORDER BY b.FundNM;

-- Question 3
SELECT A8_EMPLOYEE.EmployeeID, FirstNM, LastNM, A8_EVENT.EventID, Topic, eventdt, Count(*) AS No_Participant
FROM A8_EMPLOYEE, A8_PRESENT, A8_EVENT, A8_PARTICIPATE
WHERE A8_EMPLOYEE.EmployeeID=A8_PRESENT.EmployeeID
AND A8_EVENT.EventID=A8_PRESENT.EventID
AND A8_EVENT.EventID=A8_PARTICIPATE.EventID
AND A8_EVENT.eventdt BETWEEN TO_DATE('11/1/2018','mm/dd/yyyy') And TO_DATE('11/30/2018','mm/dd/yyyy')  
GROUP BY A8_EMPLOYEE.EmployeeID, FirstNM, LastNM, A8_EVENT.EventID, Topic, eventdt
order by No_Participant desc;

-- Question 4
SELECT A8_STOCKNM.StockNM, A8_STOCKNM.CompanyNM, A8_STOCKNM.StockExchange, A8_STOCK.Quantity, count(*) AS No_Transaction
FROM A8_TRANSACTION, A8_STOCK, A8_STOCKNM
WHERE A8_TRANSACTION.StockID=A8_STOCK.StockID
AND A8_STOCK.StockNM=A8_STOCKNM.StockNM
AND A8_TRANSACTION.TransactionDate BETWEEN TO_DATE('11/1/2018','mm/dd/yyyy') And TO_DATE('11/30/2018','mm/dd/yyyy')  
GROUP BY A8_STOCKNM.StockNM, A8_STOCKNM.CompanyNM, A8_STOCKNM.StockExchange, A8_STOCK.Quantity
ORDER BY No_Transaction DESC;

-- Question 5
SELECT FirstNM, LastNM, ReportTitle, StockNM, Investadvice, reportdt,summary
FROM A8_EMPLOYEE, A8_WRITE, A8_REPORT
WHERE A8_EMPLOYEE.EmployeeID=A8_WRITE.AnalystID
AND A8_WRITE.ReportID=A8_REPORT.ReportID
AND A8_REPORT.StockID IS NULL;
